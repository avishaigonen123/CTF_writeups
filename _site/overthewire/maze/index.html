<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="/CTF_writeups/assets/css/style.css?v=b7c7ae198d0c0d5b433ba2f5ba28241351a2fd21">
    <link rel="shortcut icon" type="image/x-icon" href="/CTF_writeups/favicon.ico">

<!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Maze Writeups | Avishai’s CTF Writeups</title>
<meta name="generator" content="Jekyll v3.10.0" />
<meta property="og:title" content="Maze Writeups" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="…" />
<meta property="og:description" content="…" />
<link rel="canonical" href="http://localhost:4000/CTF_writeups/overthewire/maze/" />
<meta property="og:url" content="http://localhost:4000/CTF_writeups/overthewire/maze/" />
<meta property="og:site_name" content="Avishai’s CTF Writeups" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Maze Writeups" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","description":"…","headline":"Maze Writeups","url":"http://localhost:4000/CTF_writeups/overthewire/maze/"}</script>
<!-- End Jekyll SEO tag -->

  </head>

  <body>

    <header>
      <div class="container">
        <a id="a-title" href="/CTF_writeups/">
          <h1>Avishai's CTF Writeups</h1>
        </a>
        <h2>...</h2>

        <section id="downloads">
          
          <a href="https://github.com/avishaigonen123/CTF_writeups" class="btn btn-github"><span class="icon"></span>View on GitHub</a>
        </section>
      </div>
    </header>

    <div class="container">
      <section id="main_content">
        <p><a href="/CTF_writeups/overthewire/" style="display:inline-block; margin-bottom: 1rem; text-decoration: none; color: #16a085; font-weight: bold;">
      ← Back to OverTheWire
    </a></p>

<h3 id="this-folder-contains-solutions-for-the-maze-wargame-from-overthewire">This folder contains solutions for the <a href="http://overthewire.org/wargames/maze/">Maze</a> wargame from OverTheWire.</h3>

<style>
  body {
    font-family: 'Arial', sans-serif;
    background-color: #eceff1;
    color: #333;
    margin: 0;
  }
  #main {
    max-width: 100% !important;
    width: 100% !important;
    margin: 0 auto;
  }
  .behemoth-container {
    display: flex;
    gap: 1.5rem;
    margin-top: 2rem;
    padding: 1rem;
  }
  .behemoth-sidebar {
    min-width: 200px;
    max-height: 90vh;
    overflow-y: auto;
    position: sticky;
    top: 1rem;
    padding: 1.5rem;
    border-radius: 8px;
    background-color: #34495e;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    color: #ecf0f1;
    margin-top: 1rem;
  }
  .behemoth-sidebar h00 {
    font-size: 1.2rem;
    font-weight: 600;
    margin-bottom: 1.5rem;
    color: #ecf0f1;
    border-bottom: 2px solid #16a085;
    padding-bottom: 0.5rem;
  }
  .behemoth-sidebar ul {
    list-style: none;
    padding-left: 0;
    font-size: 1rem;
    margin: 0;
  }
  .behemoth-sidebar li {
    margin-bottom: 0.5rem;
  }
  .behemoth-sidebar a {
    display: block;
    padding: 6px 12px;
    border-radius: 6px;
    text-decoration: none;
    color: #ecf0f1;
    transition: background 0.3s ease, color 0.3s ease;
  }
  .behemoth-sidebar a:hover {
    background-color: #16a085;
    color: #fff;
  }
  .behemoth-content {
    flex: 1;
    max-height: 90vh;
    overflow-y: auto;
    padding-right: 1rem;
    background-color: #ffffff;
    border-radius: 8px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
    padding: 2rem;
    font-size: 1rem;
    color: #333;
    margin-top: 1rem;
  }
  .behemoth-content h00 {
    font-size: 1.4rem;
    font-weight: 600;
    margin-top: 2rem;
    color:rgb(143, 151, 159);
    scroll-margin-top: 100px;
  }
  hr {
    margin: 2.5rem 0;
    border: none;
    border-top: 1px solid #ddd;
  }
  .behemoth-sidebar::-webkit-scrollbar {
    width: 8px;
  }
  .behemoth-sidebar::-webkit-scrollbar-thumb {
    background-color: #16a085;
    border-radius: 4px;
  }
  .behemoth-sidebar::-webkit-scrollbar-track {
    background-color: #ecf0f1;
  }
  @media (max-width: 768px) {
    .behemoth-container {
      flex-direction: column;
    }
    .behemoth-sidebar {
      max-height: auto;
      width: 100%;
      margin-bottom: 2rem;
    }
  }
  .level-banner {
    background-color: #16a085;
    color: #fff;
    padding: 1rem;
    text-align: center;
    font-weight: bold;
    margin-top: 2rem;
    border-radius: 8px;
  }
</style>

<div class="behemoth-container">

  <!-- Sidebar -->
  <div class="behemoth-sidebar">
    <h00>Levels</h00>
    <ul>
      
      
      
        
        
      
        
        
          <li><a href="#maze0">maze0</a></li>
        
      
        
        
          <li><a href="#maze1">maze1</a></li>
        
      
        
        
          <li><a href="#maze2">maze2</a></li>
        
      
        
        
          <li><a href="#maze3">maze3</a></li>
        
      
        
        
          <li><a href="#maze4">maze4</a></li>
        
      
        
        
          <li><a href="#maze5">maze5</a></li>
        
      
        
        
          <li><a href="#maze6">maze6</a></li>
        
      
        
        
          <li><a href="#maze7">maze7</a></li>
        
      
        
        
          <li><a href="#maze8">maze8</a></li>
        
      
    </ul>
  </div>

  <!-- Main content -->
  <div class="behemoth-content">
    
      
      
    
      
      
        <h00 id="maze0">maze0</h00>
        <p>in this level we exploit race condition.
first it checks access to a file, and then change to higher privileges and print the content of the file. 
so, we will link it to maze0 privilege, and before it opens the file for reading, we’ll change to maze1 privilege.</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">{</span>% include_relative scripts/level0/link_script.sh %<span class="o">}</span>
</code></pre></div></div>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">{</span>% include_relative scripts/level0/run_script.sh %<span class="o">}</span>
</code></pre></div></div>

<p>then, we’ll run this</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./link_script.sh &amp;
./run_script.sh | grep -av "maze0"
</code></pre></div></div>

<p><img src="/CTF_writeups/overthewire/maze/images/level1.png" alt="image" /></p>

<p><strong>Flag:</strong> <strong><em><code class="language-plaintext highlighter-rouge">kfL7RRfpkY</code></em></strong></p>

        <div class="level-banner">Next Level Writeup</div>
        <hr />
      
    
      
      
        <h00 id="maze1">maze1</h00>
        <p>in this challange, we need to create our own <code class="language-plaintext highlighter-rouge">libc.so.4</code> that will be used by the program.</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="o">%</span> <span class="n">include_relative</span> <span class="n">scripts</span><span class="o">/</span><span class="n">level1</span><span class="o">/</span><span class="n">hook</span><span class="p">.</span><span class="n">c</span> <span class="o">%</span><span class="p">}</span>
</code></pre></div></div>
<p>, you need to adjust the addresses on the stack of the (maybe) local variables.</p>

<p>the commands for compiling and linking the so file, here.</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gcc -m32 -shared -fPIC -o libc.so.4 hook.c -ldl
</code></pre></div></div>

<p>notice the tmp dir you’re working on can’t be something that <code class="language-plaintext highlighter-rouge">mktemp</code> has made, it won’t work properly.</p>

<p><img src="/CTF_writeups/overthewire/maze/images/level1.png" alt="image" /></p>

<p><strong>Flag:</strong> <strong><em><code class="language-plaintext highlighter-rouge">PBeZRPjetr</code></em></strong></p>

        <div class="level-banner">Next Level Writeup</div>
        <hr />
      
    
      
      
        <h00 id="maze2">maze2</h00>
        <p>in this challange, we inject short code that pushes the shellcode address, and then executes the shellcode.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="o">%</span> <span class="n">include_relative</span> <span class="n">scripts</span><span class="o">/</span><span class="n">level2</span><span class="o">/</span><span class="n">level2</span><span class="p">.</span><span class="n">py</span> <span class="o">%</span><span class="p">}</span>
</code></pre></div></div>

<p><img src="/CTF_writeups/overthewire/maze/images/level2.png" alt="image" /></p>

<p><strong>Flag:</strong> <strong><em><code class="language-plaintext highlighter-rouge">DSEiCewQOv</code></em></strong></p>

        <div class="level-banner">Next Level Writeup</div>
        <hr />
      
    
      
      
        <h00 id="maze3">maze3</h00>
        <p>in this challange, we need to give in argv[1] <code class="language-plaintext highlighter-rouge">0x1337c0de</code>.</p>

<p>i simply run this command: <code class="language-plaintext highlighter-rouge">/maze/maze3 $(echo -e '\xde\xc0\x37\x13')</code></p>

<p><img src="/CTF_writeups/overthewire/maze/images/level3.png" alt="image" /></p>

<p><strong>Flag:</strong> <strong><em><code class="language-plaintext highlighter-rouge">vghylBpihH</code></em></strong></p>

        <div class="level-banner">Next Level Writeup</div>
        <hr />
      
    
      
      
        <h00 id="maze4">maze4</h00>
        <p>in this challenge we override one address, and put there value that will fit our needs.
also, we need to give short script in bash that will open shell, i do it using the following commands:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="o">%</span> <span class="n">include_relative</span> <span class="n">scripts</span><span class="o">/</span><span class="n">level4</span><span class="o">/</span><span class="n">code</span><span class="p">.</span><span class="n">c</span> <span class="o">%</span><span class="p">}</span>
</code></pre></div></div>
<p>, we will use this file as shebang.</p>

<ul>
  <li>then, we need to put the payload into our file, lets say it’s input <code class="language-plaintext highlighter-rouge">python3 level5.py &gt; input</code> and of course, change to executable <code class="language-plaintext highlighter-rouge">chmod +x input</code>.</li>
</ul>

<p>the whole process:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cat &gt; code.c
gcc -m32 code.c -o code
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python3 level4.py &gt; input
chmod +x input
</code></pre></div></div>

<p><img src="/CTF_writeups/overthewire/maze/images/level4.png" alt="image" /></p>

<p><strong>Flag:</strong> <strong><em><code class="language-plaintext highlighter-rouge">fobwgnzRy0</code></em></strong></p>

        <div class="level-banner">Next Level Writeup</div>
        <hr />
      
    
      
      
        <h00 id="maze5">maze5</h00>
        <p>simple reverse engineering can show us that for the username: <code class="language-plaintext highlighter-rouge">username</code>, the password should be <code class="language-plaintext highlighter-rouge">&lt;&gt;A7?B7:</code>
<img src="/CTF_writeups/overthewire/maze/images/level5_1.png" alt="image" />
so, give these credentials:
username: <code class="language-plaintext highlighter-rouge">username</code>
password: <code class="language-plaintext highlighter-rouge">&lt;&gt;A7?B7:</code>
<img src="/CTF_writeups/overthewire/maze/images/level5_2.png" alt="image" /></p>

<p><strong>Flag:</strong> <strong><em><code class="language-plaintext highlighter-rouge">dOM2C7ZKlG</code></em></strong></p>

        <div class="level-banner">Next Level Writeup</div>
        <hr />
      
    
      
      
        <h00 id="maze6">maze6</h00>
        <p>i decompiled maze 6, here you can see the source code.</p>

<p><img src="/CTF_writeups/overthewire/maze/images/level6_1.png" alt="image" /></p>

<p>in this challenge we use buffer overflow to override the file.
we make our own File* struct, and put there in the write buffer our address, the address of the exit function in plt, and then we’ll write there the shellcode.</p>

<ul>
  <li>this is a regular FILE* struct, when we open <code class="language-plaintext highlighter-rouge">file</code> for writing.</li>
  <li>
    <p>the words i marked are: <em>_IO_write_base</em>, <em>_IO_write_ptr</em>, <em>_IO_write_end</em>
<img src="/CTF_writeups/overthewire/maze/images/level6_2.png" alt="image" /></p>
  </li>
  <li>
    <p>we need to find the address of exit in the plt record
<img src="/CTF_writeups/overthewire/maze/images/level6_3.png" alt="image" />
<img src="/CTF_writeups/overthewire/maze/images/level6_4.png" alt="image" />
so, the address of exit function in plt is <code class="language-plaintext highlighter-rouge">0x0804b208</code></p>
  </li>
  <li>we need to inject our shellcode and find its address, we need to find the address of our malware FILE* struct.
<img src="/CTF_writeups/overthewire/maze/images/level6_5.png" alt="image" />
we can see that the address of shellcode is <code class="language-plaintext highlighter-rouge">0xffffd204</code> and address of our malware FILE* struct <code class="language-plaintext highlighter-rouge">0xffffd158</code></li>
</ul>

<p>for summary, we need to find this values:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>FILE_struct_address  = 0xffffd158
plt_exit_address = 0x0804b208
shellcode_address = 0xffffd204
</code></pre></div></div>
<p>the code can be found here [level7.py]</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="o">%</span> <span class="n">include_relative</span> <span class="n">scripts</span><span class="o">/</span><span class="n">level6</span><span class="o">/</span><span class="n">level6</span><span class="p">.</span><span class="n">py</span> <span class="o">%</span><span class="p">}</span>
</code></pre></div></div>

<p><img src="/CTF_writeups/overthewire/maze/images/level6_6.png" alt="image" /></p>

<p><strong>Flag:</strong> <strong><em><code class="language-plaintext highlighter-rouge">B6XkM3Syq6</code></em></strong></p>

        <div class="level-banner">Next Level Writeup</div>
        <hr />
      
    
      
      
        <h00 id="maze7">maze7</h00>
        <p>we will exploit the line marked, and override the ret-address by giving value of 0x44 in the size, while the ret-address is at 0x40.
<img src="/CTF_writeups/overthewire/maze/images/level7_1.png" alt="image" /></p>

<p>in the payload all the staff is \x00, with one exception, when we pass arg4 which contains the size.
we do it using buffer overflow 
<img src="/CTF_writeups/overthewire/maze/images/level7_2.png" alt="image" /></p>

<p>i marked important values: arg1, arg2, arg3, arg4, fd. (in this order), so we can see that <em>arg4</em> is found after <em>46 bytes</em>.
<img src="/CTF_writeups/overthewire/maze/images/level7_3.png" alt="image" /></p>

<p>now, all left is to create your shellcode in environment variable and put the address in the code, in <code class="language-plaintext highlighter-rouge">shellcode_address</code>.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="o">%</span> <span class="n">include_relative</span> <span class="n">scripts</span><span class="o">/</span><span class="n">level7</span><span class="o">/</span><span class="n">level7</span><span class="p">.</span><span class="n">py</span> <span class="o">%</span><span class="p">}</span>
</code></pre></div></div>

<p><img src="/CTF_writeups/overthewire/maze/images/level7_4.png" alt="image" /></p>

<p><strong>Flag:</strong> <strong><em><code class="language-plaintext highlighter-rouge">eQdZB1qy6L</code></em></strong></p>

        <div class="level-banner">Next Level Writeup</div>
        <hr />
      
    
      
      
        <h00 id="maze8">maze8</h00>
        <p>in this stage we need to open a socket on port 1337, and send data. then, we exploit format string attack, in <code class="language-plaintext highlighter-rouge">snprintf</code></p>

<p>you can run this commands:
<code class="language-plaintext highlighter-rouge">./level8.py &amp;&gt; /dev/null &amp;</code>
and then
<code class="language-plaintext highlighter-rouge">/maze/maze8</code>
the code can be found here [level8.py]</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="o">%</span> <span class="n">include_relative</span> <span class="n">scripts</span><span class="o">/</span><span class="n">level8</span><span class="o">/</span><span class="n">level8</span><span class="p">.</span><span class="n">py</span> <span class="o">%</span><span class="p">}</span>
</code></pre></div></div>

<p><img src="/CTF_writeups/overthewire/maze/images/level8.png" alt="image" /></p>

<p><strong>Flag:</strong> <strong><em><code class="language-plaintext highlighter-rouge">TtMMzTuXyi</code></em></strong></p>

        <div class="level-banner">Next Level Writeup</div>
        <hr />
      
    
  </div>

</div>

      </section>
    </div>
  </body>
</html>
