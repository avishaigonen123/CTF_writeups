<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="/CTF_writeups/assets/css/style.css?v=429416b0fbd88183bc1fba2235ca959bf77e17b2">
    
<link rel="shortcut icon" type="image/x-icon" href="/CTF_writeups/favicon.ico">

<!-- remove the cache headers -->
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="0">


<!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Utumno Writeups | Avishai’s CTF Writeups</title>
<meta name="generator" content="Jekyll v3.10.0" />
<meta property="og:title" content="Utumno Writeups" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="…" />
<meta property="og:description" content="…" />
<link rel="canonical" href="http://localhost:4000/CTF_writeups/overthewire/utumno/" />
<meta property="og:url" content="http://localhost:4000/CTF_writeups/overthewire/utumno/" />
<meta property="og:site_name" content="Avishai’s CTF Writeups" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Utumno Writeups" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","description":"…","headline":"Utumno Writeups","url":"http://localhost:4000/CTF_writeups/overthewire/utumno/"}</script>
<!-- End Jekyll SEO tag -->

  </head>

  <body>

    <header>
      <div class="container">
        <a id="a-title" href="/CTF_writeups/">
          <h1>Avishai's CTF Writeups</h1>
        </a>
        <h2>...</h2>

        <section id="downloads">
          
          <a href="https://github.com/avishaigonen123/CTF_writeups" class="btn btn-github"><span class="icon"></span>View on GitHub</a>
        </section>
      </div>
    </header>

    <div class="container">
      <section id="main_content">
        <p><a href="/CTF_writeups/overthewire/" style="display:inline-block; margin-bottom: 1rem; text-decoration: none; color: #16a085; font-weight: bold;">
      ← Back to OverTheWire
    </a></p>

<h3 id="this-folder-contains-solutions-for-the-utumno-wargame-from-overthewire">This folder contains solutions for the <a href="http://overthewire.org/wargames/utumno/">Utumno</a> wargame from OverTheWire.</h3>

<style>
  body {
    font-family: 'Arial', sans-serif;
    background-color: #eceff1;
    color: #333;
    margin: 0;
  }
  #main {
    max-width: 100% !important;
    width: 100% !important;
    margin: 0 auto;
  }
  .utumno-container {
    display: flex;
    gap: 1.5rem;
    margin-top: 2rem;
    padding: 1rem;
  }
  .utumno-sidebar {
    min-width: 200px;
    max-height: 90vh;
    overflow-y: auto;
    position: sticky;
    top: 1rem;
    padding: 1.5rem;
    border-radius: 8px;
    background-color: #34495e;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    color: #ecf0f1;
    margin-top: 1rem;
  }
  .utumno-sidebar h00 {
    font-size: 1.2rem;
    font-weight: 600;
    margin-bottom: 1.5rem;
    color: #ecf0f1;
    border-bottom: 2px solid #16a085;
    padding-bottom: 0.5rem;
  }
  .utumno-sidebar ul {
    list-style: none;
    padding-left: 0;
    font-size: 1rem;
    margin: 0;
  }
  .utumno-sidebar li {
    margin-bottom: 0.5rem;
  }
  .utumno-sidebar a {
    display: block;
    padding: 6px 12px;
    border-radius: 6px;
    text-decoration: none;
    color: #ecf0f1;
    transition: background 0.3s ease, color 0.3s ease;
  }
  .utumno-sidebar a:hover {
    background-color: #16a085;
    color: #fff;
  }
  .utumno-content {
    flex: 1;
    max-height: 90vh;
    overflow-y: auto;
    padding-right: 1rem;
    background-color: #ffffff;
    border-radius: 8px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
    padding: 2rem;
    font-size: 1rem;
    color: #333;
    margin-top: 1rem;
  }
  .utumno-content h00 {
    font-size: 1.4rem;
    font-weight: 600;
    margin-top: 2rem;
    color:rgb(143, 151, 159);
    scroll-margin-top: 100px;
  }
  hr {
    margin: 2.5rem 0;
    border: none;
    border-top: 1px solid #ddd;
  }
  .utumno-sidebar::-webkit-scrollbar {
    width: 8px;
  }
  .utumno-sidebar::-webkit-scrollbar-thumb {
    background-color: #16a085;
    border-radius: 4px;
  }
  .utumno-sidebar::-webkit-scrollbar-track {
    background-color: #ecf0f1;
  }
  @media (max-width: 768px) {
    .utumno-container {
      flex-direction: column;
    }
    .utumno-sidebar {
      max-height: none;
      width: 100%;
      margin-bottom: 2rem;
    }
  }
  .level-banner {
    background-color: #16a085;
    color: #fff;
    padding: 1rem;
    text-align: center;
    font-weight: bold;
    margin-top: 2rem;
    border-radius: 8px;
  }
</style>

<div class="utumno-container">

  <!-- Sidebar -->
  <div class="utumno-sidebar">
    <h00>Levels</h00>
    <ul>
      
      
      
        
        
      
        
        
          <li><a href="#utumno0">utumno0</a></li>
        
      
        
        
          <li><a href="#utumno1">utumno1</a></li>
        
      
        
        
          <li><a href="#utumno2">utumno2</a></li>
        
      
        
        
          <li><a href="#utumno3">utumno3</a></li>
        
      
        
        
          <li><a href="#utumno4">utumno4</a></li>
        
      
        
        
          <li><a href="#utumno5">utumno5</a></li>
        
      
        
        
          <li><a href="#utumno6">utumno6</a></li>
        
      
        
        
          <li><a href="#utumno7">utumno7</a></li>
        
      
    </ul>
  </div>

  <!-- Main content -->
  <div class="utumno-content">
    
      
      
    
      
      
        <h00 id="utumno0">utumno0</h00>
        <p>when i run the file, it says to read it, however i don’t have read permissions. so, i decided to try hooking the file, using hooking the put function.</p>

<p>After i saw the hooking works, i read the stack using <code class="language-plaintext highlighter-rouge">printf("%p %p %p %p %p %p %p %p\n")</code>, and then i saw addresses that starts with <code class="language-plaintext highlighter-rouge">0x804</code>, maybe indicates on local variables on the stack, that might contain the password.</p>
<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="o">%</span> <span class="n">include_relative</span> <span class="n">scripts</span><span class="o">/</span><span class="n">level0</span><span class="o">/</span><span class="n">hook</span><span class="p">.</span><span class="n">c</span> <span class="o">%</span><span class="p">}</span>
</code></pre></div></div>
<p>, you need to adjust the addresses on the stack of the (maybe) local variables.</p>

<p>the commands for compiling and linking the so file, here.</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gcc -m32 -shared -fPIC -o hook.so hook.c -ldl
LD_PRELOAD=./hook.so /utumno/utumno0
</code></pre></div></div>

<p><img src="/CTF_writeups/overthewire/utumno/images/level0.png" alt="image" /></p>

<p><strong>Flag:</strong> <strong><em><code class="language-plaintext highlighter-rouge">ytvWa6DzmL</code></em></strong></p>

        <div class="level-banner">Next Level Writeup</div>
        <hr />
      
    
      
      
        <h00 id="utumno1">utumno1</h00>
        <p>here, we need to put our shellcode after “sh_”. there is a small problem that we can’t use “\” in the shell code, because this char can’t be in filname</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="o">%</span> <span class="n">include_relative</span> <span class="n">scripts</span><span class="o">/</span><span class="n">level1</span><span class="o">/</span><span class="n">level1</span><span class="p">.</span><span class="n">py</span> <span class="o">%</span><span class="p">}</span>
</code></pre></div></div>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">{</span>% include_relative scripts/level1/script.sh %<span class="o">}</span>
</code></pre></div></div>

<p>In the shellcode it tries to execute this command: <code class="language-plaintext highlighter-rouge">system("sh")</code>, so it means we need to link it to <code class="language-plaintext highlighter-rouge">/bin/sh</code>.</p>

<p>put the code in the files <code class="language-plaintext highlighter-rouge">cat &gt; script.sh</code> and <code class="language-plaintext highlighter-rouge">cat &gt; shellcode.py</code></p>

<p>these are the commands that you need to run.</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>chmod +x script.sh
ln -sf /bin/sh sh
./script.sh
</code></pre></div></div>
<p>lastly, run this: <code class="language-plaintext highlighter-rouge">/utumno/utumno1 .</code></p>

<p><img src="/CTF_writeups/overthewire/utumno/images/level1.png" alt="image" /></p>

<p><strong>Flag:</strong> <strong><em><code class="language-plaintext highlighter-rouge">RdUzprHKSm</code></em></strong></p>

        <div class="level-banner">Next Level Writeup</div>
        <hr />
      
    
      
      
        <h00 id="utumno2">utumno2</h00>
        <p>first we can see there is no protection, and also ASLR disabled.
<img src="/CTF_writeups/overthewire/utumno/images/level2_1.png" alt="image" /></p>

<p>then, after analyzing the code i realized that i can pass at the 9th place of envp some content that will be written to a buffer, and also i found out that the ret address is found in the stack after 16 bytes. 
so, what we need to do is override the ret address and put our shellcode.</p>

<p>because we run with envp, it overrides our regular SHELLCODE environment variable.</p>

<p>we need to find the address of the shellcode, try debugging and find it. for example: 
<img src="/CTF_writeups/overthewire/utumno/images/level2_2.png" alt="image" />
(here i debug and put breakpoint on where the main of /utumno/utumno2 is find, it won’t change because ASLR is turned off)</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="o">%</span> <span class="n">include_relative</span> <span class="n">scripts</span><span class="o">/</span><span class="n">level2</span><span class="o">/</span><span class="n">level2</span><span class="p">.</span><span class="n">c</span> <span class="o">%</span><span class="p">}</span>
</code></pre></div></div>
<p>, only change the address_of_shellcode variable and this should work.</p>

<p><img src="/CTF_writeups/overthewire/utumno/images/level2_3.png" alt="image" /></p>

<p><strong>Flag:</strong> <strong><em><code class="language-plaintext highlighter-rouge">h3kVKJZuid</code></em></strong></p>

        <div class="level-banner">Next Level Writeup</div>
        <hr />
      
    
      
      
        <h00 id="utumno3">utumno3</h00>
        <p>first we can see there is no protection, and also ASLR disabled.
<img src="/CTF_writeups/overthewire/utumno/images/level3_1.png" alt="image" /></p>

<p>i decompiled the file using ghidra, and find out that we can manipulate our input in order to override the return address to our shellcode address. 
<img src="/CTF_writeups/overthewire/utumno/images/level3_2.png" alt="image" /></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="o">%</span> <span class="n">include_relative</span> <span class="n">scripts</span><span class="o">/</span><span class="n">level3</span><span class="o">/</span><span class="n">shellcode</span><span class="p">.</span><span class="n">py</span> <span class="o">%</span><span class="p">}</span>
</code></pre></div></div>
<p>, that runs: <code class="language-plaintext highlighter-rouge">execve('/bin/cat','/tmp/passwwd')</code></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="o">%</span> <span class="n">include_relative</span> <span class="n">scripts</span><span class="o">/</span><span class="n">level3</span><span class="o">/</span><span class="n">level3</span><span class="p">.</span><span class="n">py</span> <span class="o">%</span><span class="p">}</span>
</code></pre></div></div>
<p>, you need to change the address of the shellcode based on the address of your environment variable.</p>

<p>also, you need to run this command: <code class="language-plaintext highlighter-rouge">ln -sf /etc/utumno_pass/utumno4 /tmp/passwwd</code></p>

<p><img src="/CTF_writeups/overthewire/utumno/images/level3_3.png" alt="image" /></p>

<p><strong>Flag:</strong> <strong><em><code class="language-plaintext highlighter-rouge">qHWLExh7C5</code></em></strong></p>

        <div class="level-banner">Next Level Writeup</div>
        <hr />
      
    
      
      
        <h00 id="utumno4">utumno4</h00>
        <p>first we can see there is no protection, and also ASLR disabled.
<img src="/CTF_writeups/overthewire/utumno/images/level4_1.png" alt="image" /></p>

<p>in this level we do buffer overflow, but we also need to pass one check, this check:
<img src="/CTF_writeups/overthewire/utumno/images/level4_2.png" alt="image" />
check that the len of the buffer answer on specific rule.</p>

<p>here you can find the shellcode <a href="/CTF_writeups/overthewire/utumno/general/shellcode.py">shellcode.py</a></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="o">%</span> <span class="n">include_relative</span> <span class="n">scripts</span><span class="o">/</span><span class="n">level4</span><span class="o">/</span><span class="n">level4</span><span class="p">.</span><span class="n">py</span> <span class="o">%</span><span class="p">}</span>
</code></pre></div></div>
<p>, you need to change the address of the shellcode based on the address of your environment variable.</p>

<p><img src="/CTF_writeups/overthewire/utumno/images/level4_3.png" alt="image" /></p>

<p><strong>Flag:</strong> <strong><em><code class="language-plaintext highlighter-rouge">vY134qxapL</code></em></strong></p>

        <div class="level-banner">Next Level Writeup</div>
        <hr />
      
    
      
      
        <h00 id="utumno5">utumno5</h00>
        <p>same as level3, took the code from there.</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="o">%</span> <span class="n">include_relative</span> <span class="n">scripts</span><span class="o">/</span><span class="n">level5</span><span class="o">/</span><span class="n">level5</span><span class="p">.</span><span class="n">c</span> <span class="o">%</span><span class="p">}</span>
</code></pre></div></div>

<p><img src="/CTF_writeups/overthewire/utumno/images/level5.png" alt="image" /></p>

<p><strong>Flag:</strong> <strong><em><code class="language-plaintext highlighter-rouge">aGlKWrixsh</code></em></strong></p>

        <div class="level-banner">Next Level Writeup</div>
        <hr />
      
    
      
      
        <h00 id="utumno6">utumno6</h00>
        <p>first i took the code and decompiled it using ghidra.
i can see integer overflow, that we can give it negative value and go back in the memory.
<img src="/CTF_writeups/overthewire/utumno/images/level6_1.png" alt="image" /></p>

<p>the idea behind the attack is to override where the return address is found, and put our shellcode address.
<img src="/CTF_writeups/overthewire/utumno/images/level6_2.png" alt="image" /></p>

<p>we can see that the address of the <code class="language-plaintext highlighter-rouge">auStack_34</code> is located in [ebp-0x34], so if we’ll set <code class="language-plaintext highlighter-rouge">arg1 = -1</code>, we can override the address. than, we need to find where on the stack the return address is found, take this memory location, and this will be the new address of our <code class="language-plaintext highlighter-rouge">auStack_34</code>
<img src="/CTF_writeups/overthewire/utumno/images/level6_3.png" alt="image" /></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="o">%</span> <span class="n">include_relative</span> <span class="n">scripts</span><span class="o">/</span><span class="n">level6</span><span class="o">/</span><span class="n">level6</span><span class="p">.</span><span class="n">py</span> <span class="o">%</span><span class="p">}</span>
</code></pre></div></div>
<p>.</p>

<p><img src="/CTF_writeups/overthewire/utumno/images/level6_4.png" alt="image" /></p>

<p><strong>Flag:</strong> <strong><em><code class="language-plaintext highlighter-rouge">VHOuCx7iA5</code></em></strong></p>

        <div class="level-banner">Next Level Writeup</div>
        <hr />
      
    
      
      
        <h00 id="utumno7">utumno7</h00>
        <p>here we override the ebp stored register, and put there our address. in the code it called <code class="language-plaintext highlighter-rouge">buffer_address</code>, you need to put there the address of the buffer.
also, there is address for the shellcode, which stored in <code class="language-plaintext highlighter-rouge">shellcode_address</code>.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="o">%</span> <span class="n">include_relative</span> <span class="n">scripts</span><span class="o">/</span><span class="n">level7</span><span class="o">/</span><span class="n">level7</span><span class="p">.</span><span class="n">py</span> <span class="o">%</span><span class="p">}</span>
</code></pre></div></div>
<p>, you need to fill these two fields with correct addresses.</p>

<p><img src="/CTF_writeups/overthewire/utumno/images/level7.png" alt="image" /></p>

<p><strong>Flag:</strong> <strong><em><code class="language-plaintext highlighter-rouge">oqnM7PWFIn</code></em></strong></p>

        <div class="level-banner">Next Level Writeup</div>
        <hr />
      
    
  </div>

</div>

      </section>
    </div>
  </body>
</html>
